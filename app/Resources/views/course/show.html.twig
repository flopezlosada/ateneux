{% extends '::layout_show.html.twig' %}
{% block more_css %}
    <link rel="stylesheet" href="{{ asset('bundles/app/fancybox/jquery.fancybox.css') }}"/>
{% endblock %}
{% block main -%}
    <div class="panel panel-default">
        <div class="panel-heading">
            <h1>Ficha de curso: {{ course }} </h1>
            {% if course.getMentorTeacher == null %}
                <div class="alert alert-danger">
                    Debes definir la/el tutor del curso <a
                            href="{{ path('teacher_select_mentor_teacher', {'course_id': course.id}) }}"
                            class="alert-link">Indicar</a>.
                </div>
            {% endif %}
        </div>
        <div class="panel-body">
            <div class="row">

                <div class="col-lg-7">
                    <p><strong>Nombre: </strong>{{ course }}</p>

                    <strong>Fecha de inicio:</strong> {{ course.startdate|localizeddate('long','none','es') }}<br>

                    <strong>Fecha de fin:</strong> {{ course.enddate|localizeddate('long','none','es') }}

                    {% if course.getMentorTeacher is not null %}
                        <p><strong>Tutora/or del curso: <a
                                        href="{{ path('teacher_show', {'id': course.getMentorTeacher.id}) }}">{{ course.getMentorTeacher }}</a>
                            </strong></p>
                    {% endif %}
                </div>
                <div class="col-lg-5">
                    <div class="well">
                        <h4>Acciones</h4>

                        <p><a href="{{ path("add_students",{'course':course.getId}) }}">
                                <button class="btn btn-outline btn-default" type="button">Añadir estudiantes
                                </button>
                            </a>
                            <a href="{{ path('course_edit', {'id': course.id}) }}">
                                <button class="btn btn-outline btn-warning" type="button">Editar curso
                                </button>
                            </a></p>
                        <p><a href="{{ path('assessmentboard_new', {'course_id': course.id}) }}">
                                <button class="btn btn-outline btn-success" type="button">Añadir junta de evaluación
                                </button>
                            </a></p>
                    </div>
                </div>
                <div class="col-lg-12">
                    {% if course.getStudents|length>0 %}

                        <div class="alert alert-info"><h4>Listado de estudiantes ({{ course.getStudents|length }})</h4>
                        </div>
                        <div class="table-responsive">
                            <table id="table_list"
                                   class="table table-striped table-bordered table-hover dataTable no-footer"
                                   aria-describedby="dataTables-example_info">
                                <thead>
                                <tr>
                                    <th>Nombre completo</th>
                                    <th>Acciones</th>
                                </tr>
                                </thead>
                                <tfoot>
                                <tr role="row">
                                </tr>
                                </tfoot>
                                <tbody>
                                {% for student in course.getStudents %}
                                    <tr>
                                        <td><a href="{{ path('student_show', { 'id': student.id }) }}">{{ student }}</a>
                                        </td>
                                        <td>
                                            <ul>
                                                {% if is_granted("ROLE_ADMIN")   or is_granted("ROLE_JEFATURA") %}
                                                    {# <li>
                                                         <a href="{{ path('student_edit', { 'id': student.id }) }}">editar</a>
                                                     </li>#}
                                                    {% if student.getCourse.getId is not defined %}
                                                        <li>
                                                            <a href="{{ path('student_course', {'student_id': student.id}) }}"
                                                               class="alert-link">Definir curso</a>.
                                                        </li>
                                                    {% endif %}
                                                {% endif %}
                                                {% if (is_granted("ROLE_TEACHER") and app.user.getTeacher.getMentorCourse.id is defined
                                                and app.user.getTeacher.getMentorCourse.id== course.id) or is_granted ("ROLE_ADMIN")
                                                or is_granted("ROLE_JEFATURA") %}
                                                    <li>
                                                        <a href="{{ path('meeting_new', {'student_id': student.id}) }}">Programar
                                                            reunión
                                                        </a></li>
                                                    {#{% if "now"|date("m/d/Y") < real_course.endDateCourse %}#}
                                                    <li><a href="{{ path('student_promote', {'id': student.id}) }}">Promocionar
                                                            (sólo válido a partir del final de curso)</a>
                                                    </li>
                                                    {#{% endif %}#}

                                                {% endif %}
                                            </ul>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                    {% if course.assessmentsBoard|length >0 %}
                        <div class="alert alert-info"><h4>Juntas de evaluación</h4></div>
                        <div class="table-responsive">
                            <table id="table_list"
                                   class="table table-striped table-bordered table-hover dataTable no-footer"
                                   aria-describedby="dataTables-example_info">
                                <thead>
                                <tr>
                                    <th>Nombre completo</th>
                                    <th>Acciones</th>
                                </tr>
                                </thead>
                                <tfoot>
                                <tr role="row">
                                </tr>
                                </tfoot>
                                <tbody>
                                {% for assessment in course.assessmentsBoard %}
                                    <tr>
                                        <td>
                                            <a href="{{ path('assessmentboard_show', {'id': assessment.getId}) }}">{{ assessment }}</a>
                                        </td>
                                        <td>
                                            <ul>
                                                {% if (is_granted("ROLE_TEACHER") and app.user.getTeacher.getMentorCourse.id is defined
                                                and app.user.getTeacher.getMentorCourse.id == course.id)
                                                or is_granted ("ROLE_ADMIN")
                                                or is_granted("ROLE_JEFATURA") %}
                                                    <li>
                                                        <a href="{{ path('assessmentboard_edit', {'id': assessment.getId }) }}">Editar</a>
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% if is_granted("ROLE_JEFATURA") %}
        <ul>
            <li>
                <a href="{{ path('course_index') }}">Volver al listado de cursos {{ real_course.realCourse }}</a>
            </li>
            <li>
                <a href="{{ path('course_edit', { 'id': course.id }) }}">Editar datos del curso {{ course }}</a>
            </li>
            {% if is_granted("ROLE_ADMIN") %}
                <li>
                    {{ form_start(delete_form) }}
                    <input type="submit" value="{{ "Delete"|trans }}">
                    {{ form_end(delete_form) }}
                </li>
            {% endif %}
        </ul>
    {% endif %}
{% endblock %}